machine:
  php:
    version: 5.4.37
  timezone:
    Asia/Shanghai

dependencies:
  pre:
    - sudo apt-add-repository -y 'deb
      http://ppa.launchpad.net/ondrej/mysql-experimental/ubuntu precise
      main'
    - sudo apt-get update; sudo DEBIAN_FRONTEND=noninteractive apt-get
      install -y mysql-server-5.6
  override:
    - make circle

test:
  override:
# split testsuite into pieces to avoid memory leak
#    - ./bin/phpunit -c ./app/phpunit.xml --testsuite all -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite wenwen_app_command -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite wenwen_app_controller -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite wenwen_app_entity -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite wenwen_app_repository -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite wenwen_app_services -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite wenwen_app_webservice -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite wenwen_frontend_controller -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite wenwen_frontend_form -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite jili_api_command -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite jili_api_controller -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite jili_api_entity -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite jili_api_form -d memory_limit=-1 --debug --verbose
    - ./bin/phpunit -c ./app/phpunit.xml --testsuite jili_api_repo -d memory_limit=-1 --debug --verbose
