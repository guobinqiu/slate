0.context
emar的回调有很多是403了，
The emar callback resposne with 403 http status.
So we need to re-callback by self.

1. confirm the duration and downlad the callback data
2/27 ~ 4/14 2015

download from yiqifa.com manager panel of cps.

ops:
unzip
gb2312 -> utf8

2. check the 403 apache access logs.

?! n/a found
request with ip host is in access.log
request with domain  host is in 91jili-access.log

$ awk -F' ' '$7 ~ "^/emar/api/callback" {print $0 }' /var/log/httpd/91jili-access.log
112.65.174.206 - - [14/Apr/2015:11:42:56 +0800] "GET /emar/api/callback?unique_id=719104b1b12dbdc33c5edb21d208a85c&create_date=2015-03-30+12%3A27%3A28&action_id=4018&action_name=%CE%A8%C6%B7%BB%E1CPS&sid=458631&wid=732204&order_no=15033029495959&order_time=2015-03-30+12%3A21%3A21&prod_id=SS23D1145131225&prod_name=&prod_count=1&prod_money=159.0&feed_back=1091692&status=R&comm_type=0.0&commision=0.0&chkcode=70254a4f6ad70213562cdf7c8d21dfdc&prod_type=0.0&am=0.0&exchange_rate=0.0&superrebate= HTTP/1.1" 200 27 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36"


3. parse the csv file 

pl
1.log


4. parse the accesslog

gb2312 encoding  output file 
gb2312->utf8 ( 2.log->3.log )

md5hash on querystring to filter duplicate request.


5.analyse the accesslog & CpsEffectConfirmData

status A R

6. load all confirmedData , fetch those confirmed during 2/27/2015 ~ 3/14/2015


6.1. 
confirmed the money is diff to init .

6.2.
generate the unique_id  ,  build R & A/F status query string by manual!!

6.3.
duplibcated R status request.
remove the earlier one bwteen the two  records with its status = 2 

6.4.
if status is A/F
    and query string is ignore!!
 
