<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<title>积粒网</title>
<link href="{{ asset('css/default.css')}}" rel="stylesheet" type="text/css" />
<link href="{{ asset('css/cpsActivity.css') }}" rel="stylesheet" type="text/css">
<script src="{{ asset('js/jquery-1.7.js')}}" type="text/javascript"></script>
<script>
var firstUrl = "{{ firstUrl | raw }}";
var lastUrl = "{{ lastUrl | raw }}";
var type = "{{ type }}";
{% if app.session.get('uid') %}
	var u = "{{ app.session.get('uid') }}";
{% else %}
	var u = "";
{% endif %}
$(document).ready(function(){
	init(u,type);

	//窗口居中垂直
	var winH = $(window).height();
	var loginH = $("#loginFrame").height();
	var loadingH = $(".loadingFrame").height();
	$("#loginFrame").css({"top":(winH-loginH)/2});
	$(".loadingFrame").css({"margin-top":(winH-loadingH)/2});
	//窗口居中水平
	var winW = $(window).width();
	var loginW = $("#loginFrame").width();
	$("#loginFrame").css({"left":(winW-loginW)/2});
}); 
function goto(type){
	switch(type){
		case 1:
			window.location.href = firstUrl; //cps
		break;
		case 2:
			window.location.href = lastUrl; //shop
		break;
	}

}

function onloadfinish(type){
	goto(type);
}

function init(u,type){
	if(u){
		$("#loginFrame").hide();
		hasLogin()
	}else{
		//window.location.href = "{{ path('_user_login') }}";
		$("#loginFrame").show();
	}
}
function hasLogin(){
	$("#loginFrame").hide();
	$("#iframeDiv").html("<iframe id=\"iframe\" src=\""+firstUrl+"\" onload=\"onloadfinish({{ type }})\" name=\"iframe\" style=\"display:none;\"></iframe>");
}
function sendLoginInfo(){
    $.ajax({  
        url: "{{ path('_default_ad_login') }}?pwd="+$("#pwd").val()+"&email="+$("#email").val(),
        type: "POST",
        success:function(data){
           if(data=='ok'){
            	hasLogin();
           }else{
        	   $(".error").html(data);
           }
        }
      });
}
</script>
</head>
<body>

<div id="iframeDiv"></div>

<div class="loadingFrame">
	<p class="logo"><img src="{{ asset('images/logo.gif') }}"></p>
	<p>积粒网正在为您跳转，请稍等...</p>
</div>
<div id="loginFrame">
<form action="{{ path('_default_index') }}" method="post" name="form1" id="form1">
	<h2>登录</h2>
	<div class="loginForm">
        <li class="error"></li>
    	<li><dd>用户名</dd><dt><input class="name" id="email" name="email" type="text" value="{{ email }}"></dt></li>
        <li><dd>密  码</dd><dt><input class="password" id="pwd" name="pwd" type="password"><a href="{{ asset(path('_user_resetPwd'),'cdn1') }}" class="forget">忘记密码？</a></dt></li>
        <li><dd>&nbsp;</dd><dt><a class="loginBtn" onclick="sendLoginInfo();" >登录</a><input type="checkbox" value="1" name="remember_me" type="checkbox" >记住我<a href="{{ path('_user_reg') }}" class="regBtn">立即注册</a></dt></li>
    </div>
    <div class="directGo">不登录？<a class="directGoBtn" onclick="hasLogin();" href="javascript:void(0);">直接跳转</a></div>
</form>
</div>
</body>
</html>