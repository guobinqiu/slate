<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<title>积粒网-兑换支付宝</title>
{% include 'JiliApiBundle::seo.html.twig' %}
<!-- [if lt IE9] -->
<script src="{{ asset('js/html5.js')}}" type="text/javascript"></script>
<!-- [endif] -->
<link href="{{ asset('css/default.css')}}" rel="stylesheet" type="text/css" />
<link href="{{ asset('css/personalAside.css')}}" rel="stylesheet" type="text/css" />
<link href="{{ asset('css/exchange.css')}}" rel="stylesheet" type="text/css" />
<script src="{{ asset('js/jquery-1.7.js')}}" type="text/javascript"></script>
<script type="text/javascript">
var existAlipay = "{{ existAlipay }}";
var existRealName = "{{ existRealName }}";
$(document).ready(function() {
  {% if existAlipay %}
    $(".form dt:eq(1)").hide();
    $(".form dt:eq(2)").hide();
    $(".form dt:eq(4)").hide();
    $(".form dt:eq(5)").hide();
    $(".form dd:eq(1)").hide();
    $(".form dd:eq(3)").hide();
  {% else %}
    $(".form dt:eq(0)").hide();
    $(".form dt:eq(3)").hide();
  {% endif %}
  $(".otherUser").click(function (){
    $("#existAlipay").val('1');
    $(".form dt:eq(0)").hide();
    $(".form dt:eq(3)").hide();
    $(".form dt:eq(1)").show();
    $(".form dt:eq(2)").show();
    $(".form dd:eq(1)").show();
    $(".form dd:eq(3)").show();
    $(".form dt:eq(4)").show();
    $(".form dt:eq(5)").show();
  })
	if($("#over").html()<0){
		$("#active").hide();
    $("#unactive").show();
		}else{
      $("#active").show();
      $("#unactive").hide();
    }
});
function change(){
		if($("#over").html()>=0){
      var filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
      var mobile = /^1[3|4|5|8][0-9]\d{4,8}$/;
      if(existAlipay=='' || $("#existAlipay").val()!=''){
        if($("#alipay").val()==''){
            $("#error").html("<font color='red'>请输入您的支付宝账号</font>");
            return false;
        }
        if(!filter.test($("#alipay").val())){
            if(!mobile.test($("#alipay").val())){
              $("#error").html("<font color='red'>支付宝账号应是邮件格式或手机格式</font>");
              return false;
            }
        }
        if($("#alipay").val()!=$("#re_alipay").val()){
          $("#error").html("<font color='red'>2次输入的支付宝账号不相同</font>");
          return false;
        }
         if($("#real_name").val()==''){
            $("#error").html("<font color='red'>请输入您的真实姓名</font>");
            return false;
        }
      }
      var exchange_total = $(".rechange").html();
      $('#changes').val(exchange_total);
			$("#form1").submit();
    }
}
function changePoint(){
	var total = $("#point").val();
	var over = {{ points }} - total;
	$(".rechange").html(total);
  $(".rechangeMi").html(total);
	$("#over").html(over);
	if($("#over").html()<0){
		$("#active").hide();
		$("#unactive").show();
	}else{
    $("#active").show();
    $("#unactive").hide();
  }
}
</script>
</head>
<body>
{% include 'JiliApiBundle::header.html.twig' %}
<div class="webArticle exchange">
<form action="{{ path('_exchange_alipayInfo') }}" method="post" id="form1">
  <h2><span class="font18 corLightRed crumbTit">兑换信息</span></h2>
  <aside>
   {% include 'JiliApiBundle:User:rightInfo.html.twig' %}
  </aside>
  <article>
    <div class="wenwen">
      <div class="form">
        <dd>支付宝账号：</dd>
        <dt>{{ existAlipay }} <a class="otherUser">使用其他账号</a></dt>
        <dt><input id="alipay" type="text" name="alipay" value="{{ alipay }}" /></dt>
        <dd>再次输入账号：</dd>
        <dt><input id="re_alipay" type="text" name="re_alipay" /></dt>
        <dd>姓名：</dd>
        <dt>{{ existRealName }}</dt>
        <dt><input id="real_name" type="text" name="real_name" /></dt>
        <dd>&nbsp;</dd><dt style="color: #EA4B11;">请填写真实姓名与支付宝匹配，否则有可能兑换失败</dt>
        <dd>选择兑换金额：</dd>
        <dt><select id="point" name="point"  onchange="changePoint();">
            <option value='3030'>30元</option>
            <option value='5000'>50元</option>
          </select>
         = <span  class="rechange">3030</span> 米粒</dt>
         <dd></dd><dt class="notice">支付宝每笔兑换会收取1元的手续费，截止2014-02-28，积粒网都会承担支付所有的手续费。 2014-03-01日起，对于3000米粒兑换30元支付宝余额的每笔兑换，积粒网将向用户收取0.3元的手续费(余下0.7元仍由积粒网支付)。 而5000米粒兑换50元支付宝余额的兑换，积粒网将会全额支付手续费。</dt>

      </div>
       <input type="hidden" name="existAlipay" id="existAlipay"/>
       <input type="hidden" name="existRealName" id="existRealName"/>
      <input type="hidden" name="rechange" id="changes"/>
      <div class="changePoint mt50">本次充值所需米粒：<span class="rechangeMi">3030</span></div>
      <div class="changePoint">兑换后剩余米粒：<span id="over">{{ points-3030 }}</span></div>
      <div><span id='error' style="color:red">{{code}}</span></div>
      <div class="btnArea mt50"><img id="active" onclick="change();" src="{{ asset('images/changeEnterBtn.jpg')}}" width="175" height="60">
      <img id="unactive" src="{{ asset('images/changeEnterBtn_unactive.jpg')}}" width="175" height="60"></div>
    </div>
  </article>
  <input type="hidden" value="{{ tokenKey }}" name="tokenKey" />
  </form>
</div>
{% include 'JiliApiBundle::footer.html.twig' %}
</body>
</html>

