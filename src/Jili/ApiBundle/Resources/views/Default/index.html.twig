<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
{% include 'JiliApiBundle::seo.html.twig' %}
<title>积粒网-首页 一站式积分媒体！</title>
<!-- [if lt IE9] -->
<script src="{{ asset('js/html5.js')}}" type="text/javascript"></script>
<!-- [endif] -->
<link href="{{ asset('css/default.css')}}" rel="stylesheet" type="text/css" />
<link href="{{ asset('css/index.css')}}" rel="stylesheet" type="text/css" />
<script src="{{ asset('js/jquery-1.7.js')}}" type="text/javascript"></script>
<script src="{{ asset('js/banner.js')}}" type="text/javascript"></script>
<script src="{{ asset('js/signIn.js')}}" type="text/javascript"></script>
</head>
<body>
{% include 'JiliApiBundle::header.html.twig' %}
<script type="text/javascript">
$(document).ready(function(){
   getCenter();
   $(".signInExplain").hide();
   $("#signInFrame").hide();
   $.ajax({
          url: "{{ path('_checkin_clickCount') }}",
          post: "GET",
          success:function(data){
              if(data<3){
                var times = parseInt(3-parseInt(data));
                $("#remain").text(times);
                $("#m_remain").text(times);
              }else{
                $("#remain").text(0);
                $("#m_remain").text(times);
                aremove();
              } 
          }
    });

    $("#login").click(function(){
       $("#form1").submit();
    })

    $(".close").click(function(){
       $(".signInExplain").hide();
       $(".blackBg").hide();
       $("#signInFrame").hide();
    });
});
function getCenter(){
    var windowWidth = document.documentElement.clientWidth;
    var windowHeight = document.documentElement.clientHeight;
    var popupHeight = $("#signInFrame").height();
    var popupWidth = $("#signInFrame").width();
    $("#signInFrame").css({
        "position": "absolute",
        "top": windowHeight/2-popupHeight/2,
        "left": windowWidth/2-popupWidth/2
    });
}
function popIn(){
   $(".signInExplain").show();
}
function popOut(){
   $(".signInExplain").hide();
}
function signs(){
  $(".signInExplain").show();
  $("#signInFrame").show();
  $(".blackBg").show();
}
function aremove(){
  $("#sign").removeClass('signIn');
  $("#sign").addClass('signIn close');
  $("#sign").removeAttr("onclick");
  $("#sign").attr('onMouseOver',null);
}
function goto(cid,aid,points){
    var w = window.open("","_blank");
    $.ajax({
          url: "{{ path('_advertiserment_click') }}?id="+aid,
          post: "GET",
          success:function(data){
              if(data==1){
                 $.ajax({
                    url: "{{ path('_checkin_issetClick') }}?cid="+cid,
                    post: "GET",
                    success:function(data){
                      if(data == 1){
                          var nowTimes = parseInt(parseInt($("#remain").text())-1);
                          if(nowTimes<=0){
                              $("#signInFrame h5").html("恭喜您签到成功，已获得<font color='#E94C1B'>"+points+"</font>米粒！");
                              $("#m_remain").text(nowTimes);
                          }else{
                              $("#remain").text(nowTimes);
                              $("#m_remain").text(nowTimes);
                          }

                      }
                      $(".image"+cid).removeAttr("onclick");
                          $(".goTo "+cid).removeAttr("onclick");
                          $.ajax({
                                url: "{{ path('_checkin_clickInsert') }}?cid="+cid+"&aid="+aid,
                                post: "GET",
                                success:function(data){ 
                                  var points = $("#points").text();
                                  var obj = JSON.parse(data);
                                  w.location.href = obj.url;
                                  // w.focus();
                                  // window.open(obj.url, "s", "resizable=yes, toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, copyhistory=no").blur();
                                  // window.focus();
                                  if(obj.code==1){  
                                      $(".signInExplain").hide();
                                      aremove();
                                      $("#points").text(parseInt(obj.point)+parseInt(points));
                                  }
                                }
                          });
                    }
                 });
              }else if(data==0){
                  window.location.href="{{ path('_user_login') }}";
                  w.close();
              }else{
                  w.close();
              }
          },
          error:function(){
             w.close();
          }
      });
}
</script>

<div class="webArticle index">
	<section class="one">
        <div id="banner">
        	<ul class="bannerImg">
        	{% for item in advertise_banner %}
        	<li><a href="{{ item.adUrl }}"><img src="{{ asset(item.iconImage) }}"/></a></li>
        	{% endfor %}
            	
            </ul>
            <div class="bannerNumber"><a href="#" class="hover">1</a>
            {% for i in 2..banner_count %}
               <a href="#">{{ i }}</a> 
            {% endfor %}
            </div>
        </div>

        <div id="userInformation">
        {% if user %}
    	<div class="after">
        	<div class="user">
        	    {% if user.iconPath %}
            	    <div class="photo"><a href="{{ path('_user_info')}}" ><img src="{{ asset(user.iconPath) }}" width="90" height="90"></a></div>
            	{% else %}
            	   <div class="photo"> <a href="{{ path('_user_info')}}" ><img src="{{ asset('images/default_face.jpg') }}" width="90" height="90"/></a></div>
            	 {% endif %}
                <p>您好，<a href="{{ path('_user_info')}}" class="hello">{{ limitNick }}</a>
               <!-- <a class="personalBtn" href="{{ path('_user_info')}}"><img src="{{ asset('images/myCenterBtn.png') }}"/></a>--></p>
                <p class="point">米粒：<span id="points">{{ user.points }}</span></p>

                 <!--<div class="clear"></div>
                  <a class="signIn" id="sign" onclick="signs();" onMouseOver="popIn();" onMouseOut="popOut();"></a>
                  <div class="signInExplain">打开<span id="m_remain">3</span>个商城就可获得<span>{{ checkinPoint }}</span>个积分！</div>-->
               
                <a class="signWait"></a>
                <div class="clear"></div>
            </div>
            <ul>
            	<li><a href="{{ asset(path('_user_adtaste',{'type':0}),'cdn1') }}" >我的任务历史</a></li>
                <li><a href="{{ asset(path('_user_exchange',{'type':0,'exchangeType':1}),'cdn1') }}" >我的兑换历史</a></li>
            </ul>
        </div> 
        {% else %}
       <form action="{{ path('_default_index') }}" method="post" name="form1" id="form1">
        <div class="before">
            <p><input name="email" type="text" class="text" id="email" value="{{ email }}"></p>
            <p><input name="pwd" type="password" class="password" id="password"></p>
            <p><input name="" id='login' type="image" class="image" src="{{ asset('images/indexLoginBtn.jpg') }}"><label>
            <input name="remember_me" type="checkbox" value="1" id="rem">记住我</label> | <a class="forget" href="{{ asset(path('_user_resetPwd'),'cdn1') }}">忘记密码?</a></span></p> 
            <p><a class="reg" href="{{ path('_user_reg') }}">免费注册</a></p>
        </div>
        </form>
        {% endif %}    
</div>
        </section>
    <section class="process"><img src="{{ asset('images/process.jpg')}}" width="960" height="85"></section>
  <section class="main">
    	<article>
        	<h2><img src="{{ asset('images/hotTask.jpg')}}" width="209" height="19" alt="热门任务"><a class="more" href="{{ asset(path('_shopping_list'),'cdn1') }}">更多>></a></h2>
        	
        	{% for item in advertise %}
               <div class="task">
               <a href="{{ asset(path('_advertiserment_index',{'id':item.id}),'cdn1') }}"><img src='{{ asset(item.listImage) }}' /></a>
                <h3><a href="{{ asset(path('_advertiserment_index',{'id':item.id}),'cdn1') }}">{{ item.title }}</a></h3>
                <p>任务奖励：
                {% if item.incentiveType==1 %}
                     <span>{{ item.incentive }}</span>米粒
                     {% elseif item.incentiveType==2 %}
                     最高获消费额<span>{{ item.reward_rate }}%</span>
                     {% else %}
                     {% endif %}
                  </p>
                     
            </div>
            {% endfor %}
        	
    </article>
    	<aside>
        	<section style="height:200px;">
            	<h4>公告<a class="more" href="{{ asset(path('_callboard_index'),'cdn1') }}">更多>></a></h4>
              <ul class="news">
              {% for item in callboard %}
                	<li><a href="{{ asset(path('_callboard_info',{'id':item.id}),'cdn1') }}"><span>【{{ item.categoryName }}】</span>{{ item.title }}</a></li>
                   
                {% endfor %}
                   <!--   <li class="last"><a href="#"><span>【活动】</span>“游戏冲冲冲”第4弹开始啦！</a></li>-->
                </ul>
            </section>
            
            
             <section style="height:400px;">
            	<h4>最新兑换</h4>
              <ul class="timeline">
                {% for item in exchange %}
                  <li><span class="userNick">{{ item.nick }}</span>兑换了{{ item.type}}<span class="userType">{{ item.targetPoint }}</span>积分</li>
               {% endfor %}
                </ul>
            </section>
           
        </aside>
  </section>
</div>
{% include 'JiliApiBundle::footer.html.twig' %}
<div class="signBlackBg"></div>
<div id="signInFrame">
  <h5>再打开<span id="remain">3</span>个商城就可以得到<span>{{ checkinPoint }}</span>个米粒啦</h5>
    <a class="close">关闭</a>
    <ul>
    {% for item in arrList %}
      <li><a onclick="goto({{ item.cid }},{{ item.id }},{{ checkinPoint }});" class="image{{ item.cid }}"><img src="{{ asset(item.list_image) }}" width="200" height="130"><p>最高返利{{ item.reward_rate }}%</p>
      <div class="gray"></div>
      <div class="goTo {{ item.cid }}">点击前往</div>
      <div class="finish">已打开</div>
      </a></li>
    {% endfor %}
    </ul>
</div>
</body>
</html>