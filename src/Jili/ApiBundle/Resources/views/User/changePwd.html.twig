<!doctype html>
<html>
<head>
<meta charset="UTF-8" />
<title></title>
<!-- [if lt IE9] -->
<script src="{{ asset('js/html5.js')}}" type="text/javascript"></script>
<!-- [endif] -->
<link href="{{ asset('css/default.css')}}" rel="stylesheet" type="text/css" />
<link href="{{ asset('css/password.css')}}" rel="stylesheet" type="text/css" />
<script src="{{ asset('js/jquery-1.7.js')}}" type="text/javascript"></script>
<script src="{{ asset('js/banner.js')}}" type="text/javascript"></script>
</head>
<script type="text/javascript">
$(function(){
	$("#spans").hide();
	$("#sames").hide();
	$(".message").hide();
});
function check(){
	$.ajax({
		url: "{{ path('_user_checkPwd') }}?pwd="+$('#oldPwd').val(),
		post: "GET",
		success:function(data){
		    if(data==1){
		    	$("#oldPwdError").addClass('error');
		        $("#oldPwdError").focus();
		        return false;
    		}else{
    			$("#oldPwdError").removeClass('error');
		        $("#oldPwdError").addClass('succeed');
		        var pwd_filter = /^[0-9A-Za-z_]{6,20}$/;
		        if(!pwd_filter.test($("#pwd").val())){
                    $("#pwdError").addClass('error');
                    $("#spans").show();
                    $("#pwdError").focus();
                    return false;
		        }else{
		        	$("#pwdError").removeClass('error');
		        	$("#pwdError").addClass('succeed');
		        	$("#spans").hide();
		        	if( $("#pwd").val() !=  $("#newPwd").val()){
		        		$("#newPwdError").addClass('error');
		        		$("#sames").show();
		        		 $("#newPwdError").focus();
		        		return false;
		        	}else{
		        		$("#newPwdError").removeClass('error');
		        		$("#pwdError").addClass('succeed');
		        		$("#sames").hide();
		        		$(".message").show();
		        		$.ajax({
		        			url: "{{ path('_user_changePwd') }}?pwd="+$("#newPwd").val(),
		        			post: "GET",
		        			success:function(data){
			        			if(data==1){
			        				$(".message").show();
			        				$("#oldPwdError").removeClass('succeed');
			        				$("#pwdError").removeClass('succeed');
			        				$('#oldPwd').val('');
			        				$("#pwd").val('');
			        				$("#newPwd").val('');
				        		}
			        			    
		        			}
		        		});
			        }
			        
		        }
        	}
		}
	});
}

</script>
<body>
{% include 'JiliApiBundle::header.html.twig' %}
<div class="webArticle password">
  <article>
  
    <div class="form">
      <h2>修改密码</h2>
      <div class="message"><img src="{{ asset('images/succeed.jpg')}}" width="39" height="44">密码修改成功！</div>
      <ul class="activate">
        <li>
          <dd>请输入旧密码：</dd>
          <dt id="oldPwdError">
            <input name="oldPwd" id="oldPwd" type="password" onblur='return check();'><font>&nbsp;</font>
        </li>
        <li>
          <dd>请输入新密码：</dd>
          <dt id="pwdError">
            <input name="pwd" id="pwd" type="password" onblur='return check();'><font>&nbsp;</font>
            <br />
            <span id="spans">6-20个字符，不能含特殊符号</span></dt>
        </li>
        <li>
          <dd>请再次输入新密码：</dd>
          <dt id="newPwdError">
            <input name="newPwd" id="newPwd" type="password" onblur='return check();'>
             <br />
            <span id="sames">2次密码不相同</span></dt>
        </li>
        <li>
          <dd></dd>
          <dt><a class="saveBtn" href="javascript:void(0);" onclick='return check();'>保存设置</a> 
          </dt>
        </li>
      </ul>
      <div class="clear"></div>
    </div>
    
  </article>
</div>
{% include 'JiliApiBundle::footer.html.twig' %}
</body>
</html>





 