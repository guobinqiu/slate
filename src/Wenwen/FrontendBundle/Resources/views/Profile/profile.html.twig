{% extends 'WenwenFrontendBundle::base.html.twig' %}
{% block title %}{{ parent() }}个人资料{% endblock %}

{% block stylesheet %}
    <link href="{{ asset('css/profile.css') }}" rel="stylesheet" type="text/css">
    <link href="{{ asset('js/plugin/Jcrop/css/jquery.Jcrop.min.css') }}" rel="stylesheet" type="text/css">
{% endblock %}

{% block header %}
    {% include 'WenwenFrontendBundle:Components:_header.html.twig' %}
{% endblock %}

{% block body %}
    <div class="main-personal w1000 clearfix">
        {% include 'WenwenFrontendBundle:Personal:_leftSideBar.html.twig' %}
        <div class="main-personal-right right rp-main-personal-right">
            <h2>个人资料</h2>
            <div class="main-personal-profile">
                <div class="profile-base">
                    <h3>基本信息</h3>
                    <div class="con clearfix">
                        <div class="face left col-t-3 col-m-12">
                            <div class="face-wapper">
                                <img id="avatar" src="{{ asset(user.iconPath|default('img/common/default_tx.png')) }}" alt="头像" width="90" height="90" />

                                <form action="{{ path('_profile_upload') }}" method="post" {{ form_enctype(uploadForm) }} id="uploadForm">
                                    {{ form_label(uploadForm.attachment, '设置头像', {'label_attr': {'class': 'set'}}) }}
                                    {{ form_widget(uploadForm.attachment, {'id': 'profile_attachment'}) }}
                                    <input type="hidden" id="x" name="x" />
                                    <input type="hidden" id="y" name="y" />
                                    <input type="hidden" id="w" name="w" />
                                    <input type="hidden" id="h" name="h" />
                                    {{ form_row(uploadForm._token) }}
                                    <p class="errorInfo"></p>
                                </form>
                            </div>
                        </div>
                        <ul class="form text left col-t-9 col-m-12">
                            <li class="nk">{{ user.nick[:12] }}</li>
                            <li class="hide rp-phone">
                                <label for="">昵称：</label>
                                <span>{{ user.nick[:12] }}</span></li>
                            <li>
                                <label for="">登录账号：</label>
                                <span>{{ user.email }}</span>
                            </li>
                            <li>
                                <label for="">当前积分：</label>
                                <span><strong id="points" name="points">{{ user.points }}</strong></span>
                            </li>
                        </ul>
                    </div>

                    <div class="picCut">
                        <div class="imageInfo left"></div>
                        <div class="resDiv left">
                            <div class="resImg"><p class="resizeimage"></p></div>
                            <div class="resizeSubmit">
                                <input type='button' value='上传图片' name='resize' class='resBtn'/><br/>
                                <input type='button' value='取消上传' name='cancel' class='cancelBtn'/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="profile-detail">
                    <h3>详细信息<b>您的个人信息将完全保密，请放心填写</b></h3>
                    {% for flash_message in app.session.flashBag.get('success') %}
                        <div class="successMess">{{ flash_message }}</div>
                    {% endfor %}

                    <form action="{{ path('_profile_edit') }}" method="post" id="profileForm" name="profileForm" >
                        <ul class="con">
                            <li>
                                {{ form_label(editForm.nick) }}
                                {{ form_widget(editForm.nick) }}
                                {{ form_errors(editForm.nick) }}
                            </li>

                            <li>
                                {{ form_label(editForm.tel) }}
                                {{ form_widget(editForm.tel) }}
                                {{ form_errors(editForm.tel) }}
                            </li>

                            <li>
                                {{ form_label(editForm.userProfile.sex) }}
                                <span>{{ form_widget(editForm.userProfile.sex) }}</span>
                            </li>

                            <li>
                                {{ form_label(editForm.userProfile.birthday) }}
                                {{ form_widget(editForm.userProfile.birthday, {'attr': {'class':'laydate-icon' }}) }}
                                {{ form_errors(editForm.userProfile.birthday) }}
                            </li>

                            <li>
                                <label>居住地：</label>

                                <select id="province" name="user[userProfile][province]">
                                    <option value="1"{% if userProfile.province == 1 %} selected="selected"{% endif %}>河北省</option>
                                    <option value="2"{% if userProfile.province == 2 %} selected="selected"{% endif %}>辽宁省</option>
                                </select>

                                <select id="city" name="user[userProfile][city]" disabled>
                                    <option data-province="河北省" value="1"{% if userProfile.city == 1 %} selected="selected"{% endif %}>石家庄</option>
                                    <option data-province="河北省" value="2"{% if userProfile.city == 2 %} selected="selected"{% endif %}>唐山</option>
                                    <option data-province="河北省" value="3"{% if userProfile.city == 3 %} selected="selected"{% endif %}>秦皇岛</option>
                                    <option data-province="辽宁省" value="4"{% if userProfile.city == 4 %} selected="selected"{% endif %}>沈阳</option>
                                    <option data-province="辽宁省" value="5"{% if userProfile.city == 5 %} selected="selected"{% endif %}>大连</option>
                                </select>

                                <span id="tmp" style="visibility: hidden; position:absolute;"></span>
                            </li>

                            <li>
                                {{ form_label(editForm.userProfile.income) }}
                                {{ form_widget(editForm.userProfile.income) }}
                            </li>

                            <li>
                                {{ form_label(editForm.userProfile.profession) }}
                                {{ form_widget(editForm.userProfile.profession) }}
                                {{ form_widget(editForm.userProfile.industry_code) }}
                                {{ form_widget(editForm.userProfile.work_section_code) }}
                            </li>

                            <li>
                                {{ form_label(editForm.userProfile.education) }}
                                {{ form_widget(editForm.userProfile.education) }}
                            </li>

                            <li>
                                {{ form_label(editForm.userProfile.hobby) }}
                                {{ form_widget(editForm.userProfile.hobby) }}
                            </li>

                            <li>
                                {{ form_label(editForm.userProfile.personalDes) }}
                                {{ form_widget(editForm.userProfile.personalDes) }}
                                {{ form_errors(editForm.userProfile.personalDes) }}
                            </li>

                            <li>
                                {{ form_label(editForm.userProfile.favMusic) }}
                                {{ form_widget(editForm.userProfile.favMusic) }}
                                {{ form_errors(editForm.userProfile.favMusic) }}
                            </li>

                            <li>
                                {{ form_label(editForm.userProfile.monthlyWish) }}
                                {{ form_widget(editForm.userProfile.monthlyWish) }}
                                {{ form_errors(editForm.userProfile.monthlyWish) }}
                            </li>
                        </ul>

                        {{ form_row(editForm._token) }}

                        <div class="btn"><span id="profile_save">保存</span></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block footer %}
    {% include 'WenwenFrontendBundle:Components:_footer.html.twig' %}
{% endblock %}

{% block javascript %}
    <script type="text/javascript" src="{{ asset('js/plugin/layDate/layDate.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/plugin/Jcrop/jquery.Jcrop.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/plugin/fileUpload/jquery.ui.widget.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/plugin/fileUpload/load-image.all.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/plugin/fileUpload/canvas-to-blob.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/plugin/fileUpload/jquery.iframe-transport.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/plugin/fileUpload/jquery.fileupload.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/plugin/fileUpload/jquery.fileupload-process.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/plugin/fileUpload/jquery.fileupload-image.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/pages/personal/profile.js') }}"></script>
{% endblock %}